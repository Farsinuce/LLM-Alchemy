# LLM Alchemy - Comprehensive Game Documentation

**Version**: 3.0  
**Last Updated**: July 28, 2025

## 1. Overview

LLM Alchemy is a modern web-based alchemy game where players combine elements to discover new ones. The outcomes of these combinations are dynamically generated by a Large Language Model (LLM), creating a unique and endlessly expandable gameplay experience.

The project is built on a robust, production-ready tech stack designed for scalability and maintainability.

*   **🚀 LIVE GAME**: https://llm-alchemy-beta2.vercel.app
*   **📂 REPOSITORY**: https://github.com/Farsinuce/LLM-Alchemy
*   **⚡ STATUS**: Live, with ongoing refactoring to prepare for a major visual redesign.

## 2. Core Gameplay

Players begin with a set of base elements and combine them in a drag-and-drop interface. The game features two distinct modes:

*   **Science Mode**: Starts with **Energy, Earth, Air, Fire, and Water**. Combinations are grounded in scientific principles, leading to discoveries like "Steam," "Mud," and "Crystal." This mode includes "End Elements" which represent terminal points in a discovery chain.
*   **Creative Mode**: Starts with **Life, Earth, Air, Fire, and Water**. Combinations are based on creative, mythological, and cultural connections, leading to discoveries like "Dragon," "Phoenix," or "Pizza."

All discoveries are automatically saved to the player's account, persisting across sessions and devices (for registered users).

## 3. Technical Architecture

### Tech Stack
- **Frontend**: Next.js 15 (App Router), React, TypeScript, Tailwind CSS v4
- **Backend**: Next.js API Routes (running on Vercel Edge Functions)
- **Database**: Supabase (PostgreSQL with Row Level Security)
- **Authentication**: Supabase Auth (supporting anonymous and registered users)
- **LLM Provider**: OpenRouter (currently using Google's Gemini Flash & Pro models)
- **Visuals**: OpenMoji for a consistent, high-quality emoji style
- **Hosting**: Vercel (with CI/CD from GitHub)
- **Payments**: Stripe (integration in progress)

### System Flow
```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Next.js App   │────▶│  API Routes      │────▶│   OpenRouter    │
│  (Game Client)  │     │  /api/generate   │     │ (Gemini LLM)    │
└─────────────────┘     └──────────────────┘     └─────────────────┘
         │                        │                      │
         ▼                        ▼                      ▼
┌─────────────────┐     ┌──────────────────┐     ┌──────────────────┐
│  Supabase Auth  │────▶│   Supabase DB    │     │ OpenMoji Service │
│ (Anon/Registered)│    │ (Game State, etc)│     │ (SVG Resolution) │
└─────────────────┘     └──────────────────┘     └──────────────────┘
```

## 4. Key Features

### OpenMoji Integration
To ensure a consistent and charming visual style, all emojis in the game are rendered using the OpenMoji library. A custom service (`openmoji-service.ts`) resolves the correct SVG for each element, using a combination of direct mapping and fuzzy search for the best match.

### Challenge System
- **Automated Generation**: A daily cron job generates new "Daily Quests" (e.g., "Discover a tool") and "Weekly Challenges" (e.g., "Discover Pizza").
- **Rewards**: Players earn tokens for completing challenges, which can be used for in-game actions.
- **UI Integration**: A `ChallengeBar` component displays active challenges to the player.

### User & Monetization System
- **Anonymous Play**: New players can start immediately without an account. Progress is saved locally, and a secure anonymous user is created in the backend.
- **Registered Users**: Players can register to sync their progress across devices and access premium features.
- **Daily Limits**: Anonymous and free users have a daily limit on free combinations.
- **Monetization (Stripe)**: A system for purchasing token packs and monthly subscriptions is implemented.
    *   **Subscription**: €5.99/month for unlimited combinations.
    *   **Token Packs**: Starting from €0.40 for 100 tokens.

### State Management & Persistence
- **Per-Mode Progress**: A player's progress in Science and Creative modes is saved independently.
- **Auto-Save**: Game state is automatically and securely saved to the Supabase database.
- **Cross-Session Restoration**: Players can close their browser and resume their game exactly where they left off.

## 5. Project Structure

The codebase is organized following Next.js best practices:

| Path | Purpose |
|---|---|
| `src/app/` | Contains all pages, API routes, and global styles. |
| `src/components/` | Reusable React components, such as the `AuthModal` or `OpenMojiDisplay`. |
| `src/lib/` | Core application logic, including Supabase helpers, LLM prompt builders, and the OpenMoji service. |
| `src/types/` | Centralized TypeScript type definitions. |
| `scripts/` | Build-time scripts, like the one that prepares the OpenMoji assets. |
| `supabase/` | SQL files for database migrations and schema definitions. |
| `refactoring-plan.md` | The detailed, step-by-step plan for the current code refactoring effort. |
| `llm-alchemy-roadmap.md` | The high-level project roadmap for future development. |
| `LLM_Alchemy_Developer_Overview.md` | A more technical, file-by-file overview for developers. |
